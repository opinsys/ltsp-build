#!/bin/bash

. /lib/lsb/init-functions
. /usr/share/ltsp/ltsp-init-common

for tag in $PUAVO_TAGS; do
    if [[ $tag =~ eno:(.*) ]] ; then
        address="${BASH_REMATCH[1]}"

        logger -t "eno-connect" "Connecting to ENO pen: ${address}"

        while (sleep 4)
        do
            connected=`sudo hidd --show` > /dev/null
            if [[ ! $connected =~ .*${address}.* ]] ; then
                logger -t "eno-connect" "Connecting to ${address} - eno-agent"
                /sbin/eno-agent hci0 ${address}

                logger -t "eno-connect" "Connecting to ${address} - hidd --connect"
                /usr/bin/hidd --connect ${address}

                logger -t "eno-connect" "Connecting to ${address} - bluez-test-device"
                /usr/bin/bluez-test-device trusted ${address}
            fi
        done

    fi
done
